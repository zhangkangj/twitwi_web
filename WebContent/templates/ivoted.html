{% extends 'index.html' %}

{% block subtitle %} : i voted{% endblock %}

{% block page_head %}
	<style>
		body {
			padding-top: 60px;
			background-image: url(static/img/bgnoise.png);
		}
		
		#vote-meter {
			margin: 10px auto 10px auto;
			width: 1000px;
			text-align: center;
		}
		
		.candidate-box {
			display: inline-block;
			margin: 10px;
			overflow: show;
			width: 250px;
		}
		
		.candidate-box img {
			display: block;
			margin: 0 auto 5px auto;
		}
		
		.candidate-box img+div{
			
		}
		
		#obama-vote, #romney-vote {
			display: inline-block;
			font-size: 4em;
			font-weight: 700;
			margin: 20px;
		}
		
		#obama-vote {
			color: #0D406B;
		}
		
		#romney-vote {
			color: #9E2017;
		}
		
		#vote-bar {
			margin: auto 10px auto 10px;
			display: inline-block;
		}
		
		#vote-map {
			margin: auto;
		}
	</style>
	<script type="text/javascript" src="/static/lib/d3/d3.v2.js"></script>
	<script type="text/javascript" src="/static/js/ivoted.js"></script>
	<link type="text/css" href="/static/css/ivoted.css" rel="stylesheet"/>
{% endblock %}

{% block content %}
	<div id="vote-meter">
		<div class="candidate-box">
			<img src="https://twimg0-a.akamaihd.net/profile_images/2325704772/wrrmef61i6jl91kwkmzq.png" width="160" height="160">
			<div>@BarackObama</div>
			<div> <div id="obama-vote">-</div> </div>
		</div>
	
		<div id="vote-bar">
		</div>
		
		<div class="candidate-box">
			<img src="https://twimg0-a.akamaihd.net/profile_images/2624978379/chw1hdzozfdew973pvjr.png" width="160" height="160">
			<div>@MittRomney</div>
			<div><div id="romney-vote">-</div> </div>
		</div>
	</div>
	
	<div id="vote-map" style = "width:1000px;height:500px;margin:auto">
	</div>

	<div class="container-fluid" style = "width:1100px; margin:auto">
		<div class="row-fluid" style = "margin:auto">
			<div class="span6">
				<h3>I voted for Obama</h3>
				<a class="twitter-timeline" data-dnt=true href="https://twitter.com/search?q=%22voted+for%22+obama" data-widget-id="265841091654324224">Tweets about ""voted for" obama"</a>
				<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
			</div>
			<div class="span6">
				<h3>I voted for Romney</h3>
				<a class="twitter-timeline" data-dnt=true href="https://twitter.com/search?q=%22voted+for%22+romney" data-widget-id="265844840665858048">Tweets about ""voted for" romney"</a>
				<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
			</div>
		</div>
	</div>
	
	<div id="disqus_thread" style = "margin:auto; margin-top:30px">
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'twithinks'; // required: replace example with your forum shortname
			//var disqus_developer = 1;
			var disqus_url = 'http://twithinks.mit.edu/ivoted';
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
	
	<script type="text/javascript">
		var interval = 60 * 1000;
		var bar_w = 400, bar_h = 100;
		var bar_svg = d3.select('#vote-bar').append('svg').attr('width', bar_w).attr('height', bar_h);
		var current = {
			timestamp: Date.now(),
			obama: 50000,
			romney: 40000,
			states: {}
		};
		var next = {
			timestamp: Date.now()+interval,
			obama: 60000,
			romney: 60000,
			states: {}
		};
		var comma = d3.format(',');
		
		function update(current, next) {
			var ct = Date.now();
			var progress = (ct - current.timestamp) / interval;
			console.log(progress);
			var oc = current.obama * (1-progress) + progress * next.obama;
			var rc = current.romney * (1-progress) + progress * next.romney;
			
			update_count(oc, rc);
		}
		
		function update_count(obama, romney) {
			d3.select('#obama-vote').text(comma(obama.toFixed(0)));
			d3.select('#romney-vote').text(comma(romney.toFixed(0)));
			
		}
		
		function update_bar(obama, romney) {
			var total = obama + romney;
			var ow = bar_w * obama / total;
			var rw = bar_w * romney / total;
			bar_svg.selectAll('rect').data(gradient).enter().append('rect').attr('class', 'gradient').attr('width', gradient_width).attr('height', gradient_height).attr('fill', function(d) { return d; }).attr('x', function(d, k) {return k*gradient_width;});
		}
	</script>
{% endblock %}
